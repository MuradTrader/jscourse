## Общее введение

Автор представляет **вычисляемые значения (computed values)** в enum — возможность использовать арифметические операции и комбинации существующих значений enum для создания новых значений.

---

## 1. Базовый пример enum с вычисляемыми значениями

### Создание enum с правами доступа:

```typescript
enum AccessPermissions {
  None = 0,
  Read = 1,
  Write = 2,
  ReadWrite = Read + Write, // Вычисляемое значение: 1 + 2 = 3
  Delete = 4,
  All = ReadWrite + Delete, // Вычисляемое значение: 3 + 4 = 7
}
```

---

## 2. Как работают вычисляемые значения

### Разбор примера:

```typescript
None = 0; // Базовое значение
Read = 1; // Базовое значение
Write = 2; // Базовое значение
ReadWrite = Read + Write; // 1 + 2 = 3
Delete = 4; // Базовое значение
All = ReadWrite + Delete; // 3 + 4 = 7
```

### Визуализация значений:

```
AccessPermissions {
    None: 0,
    Read: 1,
    Write: 2,
    ReadWrite: 3,  // (Read + Write)
    Delete: 4,
    All: 7         // (ReadWrite + Delete)
}
```

---

## 3. Преимущества вычисляемых значений

### A. Ясность и самодокументирование:

```typescript
// ❌ Менее понятно
enum Permissions {
  Read = 1,
  Write = 2,
  ReadWrite = 3, // Откуда взялось 3?
  All = 7, // Откуда взялось 7?
}

// ✅ Более понятно
enum Permissions {
  Read = 1,
  Write = 2,
  ReadWrite = Read + Write, // Ясно, что это комбинация
  All = ReadWrite + Delete, // Ясно, что включает всё
}
```

### B. Поддержка и рефакторинг:

```typescript
// Если изменить базовое значение, вычисляемые обновятся автоматически
enum Permissions {
  Read = 1, // Было 1
  Write = 2, // Было 2
  ReadWrite = Read + Write, // Автоматически 3
}

// Если изменить Read = 4, то ReadWrite станет 6 автоматически
```

---

## 4. Практическая демонстрация

### Вывод значений в консоль:

```typescript
console.log(AccessPermissions.ReadWrite); // 3
console.log(AccessPermissions.All); // 7
```

### Проверка в терминале:

```bash
# После компиляции и запуска:
3
7
```

---

## 5. Математические операции в вычисляемых значениях

### Поддерживаемые операции:

**Сложение:**

```typescript
enum Example {
  A = 1,
  B = 2,
  Sum = A + B, // 3
}
```

**Вычитание:**

```typescript
enum Example {
  A = 5,
  B = 2,
  Diff = A - B, // 3
}
```

**Умножение:**

```typescript
enum Example {
  A = 3,
  B = 4,
  Product = A * B, // 12
}
```

**Деление:**

```typescript
enum Example {
  A = 10,
  B = 2,
  Quotient = A / B, // 5
}
```

---

## 6. Битовая арифметика для флагов (распространенный случай)

### Использование битовых операций:

```typescript
enum FilePermissions {
  None = 0,
  Execute = 1 << 0, // 1 (0001)
  Write = 1 << 1, // 2 (0010)
  Read = 1 << 2, // 4 (0100)

  ReadWrite = Read | Write, // 6 (0110)
  All = Read | Write | Execute, // 7 (0111)
}
```

### Проверка флагов:

```typescript
const userPermissions = FilePermissions.ReadWrite;

// Проверка наличия прав
const canRead = (userPermissions & FilePermissions.Read) !== 0; // true
const canExecute = (userPermissions & FilePermissions.Execute) !== 0; // false
```

---

## 7. Ограничения вычисляемых значений

### Допустимые выражения:

```typescript
// ✅ РАБОТАЕТ - константные выражения
enum Valid {
  A = 1,
  B = A + 1, // Константное выражение
  C = 2 * B, // Константное выражение
}
```

### Недопустимые выражения:

```typescript
// ❌ НЕ РАБОТАЕТ - runtime значения
enum Invalid {
  A = Math.random(), // Runtime вычисление
  B = Date.now(), // Runtime вычисление
  C = someFunction(), // Runtime вычисление
}
```

---

## 8. Real-world пример: система ролей

### Иерархия прав доступа:

```typescript
enum UserRoles {
  // Базовые права
  View = 1,
  Create = 2,
  Edit = 4,
  Delete = 8,

  // Комбинированные роли
  Author = View | Create | Edit, // 1 + 2 + 4 = 7
  Moderator = View | Edit | Delete, // 1 + 4 + 8 = 13
  Admin = View | Create | Edit | Delete, // 1 + 2 + 4 + 8 = 15
}
```

### Использование в системе:

```typescript
function checkPermission(userRole: UserRoles, required: UserRoles): boolean {
  return (userRole & required) === required;
}

const user = UserRoles.Author;
console.log(checkPermission(user, UserRoles.View)); // true
console.log(checkPermission(user, UserRoles.Delete)); // false
```

---

## 9. Правила использования вычисляемых значений

### Правило 1: Порядок объявления

```typescript
// ✅ КОРРЕКТНО - значения объявлены до использования
enum Correct {
  Read = 1,
  Write = 2,
  ReadWrite = Read + Write, // Read и Write уже объявлены
}

// ❌ НЕКОРРЕКТНО - использование до объявления
enum Incorrect {
  ReadWrite = Read + Write, // Read и Write еще не объявлены
  Read = 1,
  Write = 2,
}
```

### Правило 2: Только константные выражения

```typescript
// ✅ КОНСТАНТНЫЕ ВЫРАЖЕНИЯ
const x = 5;
enum Allowed {
  A = 1 + 2, // Числовые литералы
  B = A * 2, // Другие значения enum
  C = (1 << 3) - 1, // Битовая арифметика
}
```

---

## Итог от автора

Автор подчеркивает:

1. **Вычисляемые значения** позволяют комбинировать существующие значения enum
2. **Арифметические операции** поддерживаются для числовых enum
3. **Ясность кода** — выражения делают намерения понятными
4. **Автоматическое обновление** — при изменении базовых значений
5. **Практическая ценность** — особенно для систем прав доступа

### Мой итог как разработчика

Вы изучили мощную возможность TypeScript enum:

1. **Архитектурные преимущества:**

   - **Выразительность** — код ясно передает бизнес-логику
   - **Поддержка** — изменения в одном месте распространяются автоматически
   - **Безопасность** — вычисления происходят на этапе компиляции

2. **Практические применения:**

   ```typescript
   // Системы разрешений и ролей
   enum Permissions {
     Basic = 1,
     Advanced = 2,
     Admin = 4,
     SuperUser = Basic | Advanced | Admin,
   }

   // Состояния приложения
   enum AppState {
     Initializing = 0,
     Loading = 1,
     Ready = 2,
     LoadingOrReady = Loading | Ready,
   }
   ```

3. **Лучшие практики:**

   - Используйте для логически связанных значений
   - Комментируйте сложные вычисления
   - Тестируйте итоговые значения

4. **Производительность:** Все вычисления происходят на этапе компиляции, в runtime остаются только конечные значения.

5. **Ограничения:**
   - Только для числовых enum
   - Только константные выражения
   - Порядок объявления важен

**Резюме:** Вычисляемые значения в enum превращают простые перечисления в мощные инструменты для моделирования сложных бизнес-правил и систем разрешений. Они обеспечивают баланс между выразительностью и производительностью, делая код более понятным и поддерживаемым.
