Отлично! В этом уроке автор переходит к очень важной теме - **глобальным объявлениям (global declarations)** в TypeScript. Это позволяет описывать типы для переменных и объектов, доступных в глобальной области видимости. Давайте разберем это максимально подробно.

## Детальный разбор урока:

### 1. **Концепция глобальной области видимости в JavaScript**

**Что такое глобальная область видимости:**

- В браузере глобальным объектом является `window`
- Любое свойство или метод, присвоенный `window`, становится доступным глобально
- Это распространенный паттерн в legacy JavaScript коде

### 2. **Создание JavaScript файла с глобальным объектом**

**Код в `auth-service.js`:**

```javascript
window.authService = {
  currentUser: null,

  login(username, password) {
    if (username === "user" && password === "password123") {
      this.currentUser = {
        id: 1,
        username: username,
      };
      console.log("Login successful");
      return true;
    } else {
      console.log("Login failed");
      return false;
    }
  },

  isLoggedIn() {
    return this.currentUser !== null;
  },
};
```

**Ключевые моменты:**

- Объект `authService` присваивается напрямую к `window`
- **`currentUser`** - свойство для хранения текущего пользователя
- **`login()`** - метод для аутентификации пользователя
- **`isLoggedIn()`** - метод проверки статуса аутентификации

### 3. **Подключение в HTML**

**Код в `index.html`:**

```html
<script src="auth-service.js"></script>
<script src="app.js"></script>
<!-- скомпилированный TypeScript -->
```

**Важность порядка:**

- `auth-service.js` должен быть подключен ДО `app.js`
- Это гарантирует, что глобальный объект будет доступен при выполнении TypeScript кода

### 4. **Создание global declaration file**

**Код в `global.d.ts`:**

```typescript
// Интерфейс для объекта пользователя
interface User {
  id: number;
  username: string;
}

// Интерфейс для authService
interface AuthService {
  currentUser: User | null;
  login(username: string, password: string): boolean;
  isLoggedIn(): boolean;
}

// Глобальное объявление переменной
declare var authService: AuthService;
```

### 5. **Детальное объяснение синтаксиса global declarations**

#### **Структура `global.d.ts`:**

```typescript
declare global {
  // объявления внутри блока global
}
```

**Хотя автор использует прямой подход, современный синтаксис рекомендует:**

```typescript
declare global {
  var authService: AuthService;

  interface Window {
    authService: AuthService;
  }
}
```

#### **Объявление интерфейсов:**

```typescript
interface User {
  id: number;
  username: string;
}
```

**Объяснение:**

- Интерфейсы в `global.d.ts` автоматически становятся глобальными
- Не требуют ключевого слова `export`

#### **Объявление глобальной переменной:**

```typescript
declare var authService: AuthService;
```

**Ключевые моменты:**

- **`declare`** - указывает, что переменная существует во внешней среде
- **`var`** - используется для объявления глобальных переменных (в отличие от `let`/`const`)
- **Тип `AuthService`** - описывает структуру глобального объекта

### 6. **Альтернативный подход: расширение интерфейса Window**

**Более правильный способ:**

```typescript
interface Window {
  authService: AuthService;
}
```

**Преимущества:**

- Более явно указывает, что свойство принадлежит `window`
- Соответствует стандартному поведению TypeScript для DOM API

### 7. **Использование в TypeScript коде**

**Код в `App.ts`:**

```typescript
// Использование глобальной переменной
const loginResult = authService.login("user", "password123");

// Проверка статуса аутентификации
if (authService.isLoggedIn()) {
  console.log("User is logged in");
} else {
  console.log("Login failed");
}
```

**Что получает TypeScript:**

- **Автодополнение** для методов и свойств `authService`
- **Проверка типов** параметров и возвращаемых значений
- **Понимание структуры** объекта `currentUser`

### 8. **Как TypeScript обрабатывает global declarations**

**Процесс разрешения типов:**

1. TypeScript компилятор сканирует все `.d.ts` файлы в проекте
2. Находит `global.d.ts` и загружает объявления из него
3. Объявления становятся доступны во всех TypeScript файлах без импорта

### 9. **Практическая демонстрация типизации**

**Без global.d.ts:**

```typescript
authService.login(123, 456); // ❌ TypeScript не покажет ошибку (без типов)
authService.unknownMethod(); // ❌ TypeScript не покажет ошибку (без типов)
```

**С global.d.ts:**

```typescript
authService.login(123, 456); // ❌ Ошибка: параметры должны быть string
authService.unknownMethod(); // ❌ Ошибка: метод не существует
authService.login("user", "pass"); // ✅ Правильно
```

### 10. **Технические детали реализации**

#### **Порядок компиляции:**

```
auth-service.js    -->    global.d.ts    -->    app.ts
(JavaScript)       |     (TypeScript типы)    (TypeScript код)
                   |
                   --> доступен через window
```

#### **Обработка null и union types:**

```typescript
currentUser: User | null;
```

- **Union type** позволяет переменной быть либо объектом, либо `null`
- TypeScript будет требовать проверки на `null` при использовании

### 11. **Отладка и проверка работы**

**Для проверки, что все работает:**

1. Компилируем TypeScript в JavaScript
2. Загружаем HTML страницу в браузере
3. Открываем консоль разработчика
4. Видим сообщения "Login successful" и "User is logged in"

### 12. **Особенности global.d.ts**

**Автоматическое применение:**

- Не требует импорта в других файлах
- Действует на весь проект
- Идеально для описания глобальных переменных, сторонних библиотек

**Ограничения:**

- Следует использовать осторожно, чтобы не загрязнять глобальную область
- В больших проектах лучше использовать модульную систему

## Ключевые выводы из урока:

1. **Global declarations** позволяют описывать типы для глобально доступных объектов
2. **`global.d.ts`** - специальный файл для глобальных объявлений
3. **`declare var`** - синтаксис для объявления глобальных переменных
4. **Расширение Window** - более правильный способ для свойств `window`
5. **Автоматическая доступность** - типы из `global.d.ts` доступны во всем проекте

Этот подход особенно полезен при:

- Миграции legacy JavaScript кода на TypeScript
- Работе со сторонними библиотеками, которые добавляют глобальные переменные
- Интеграции с существующим кодом, который использует глобальную область видимости
